<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="ru"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Web Lab 3 - Форма</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <h:outputStylesheet library="style" name="style.css" />
</h:head>

<h:body>
    <header>
        <div class="container">
            <span class="head-link">P3211</span>
            <span class="head-link">Михайлов Петр Сергеевич</span>
            <span class="head-link">Вариант: 28345</span>
        </div>
    </header>

    <main>
        <div class="navbar-container">
            <h:link value="Часы" outcome="index" styleClass="btn" />
        </div>

        <div class="grid-container">
            <div class="map-container">
                <h1>Map</h1>
                <div id="canvas-wrapper" class="canvas-container">
                    <canvas id="map-canvas" width="300" height="300" />
                </div>
                <p id="current_coord" style="width: 100%; text-align: center">---</p>
            </div>
            <div class="form-container">
                <h1>Control unit</h1>
                <div class="control-unit-container" id="control-unit-div">
                    <h:form id="control-form" prependId="false">
                        <div class="form-grid">
                            <p:outputLabel for="x-values" value="Выберите X:" />
                            <p:selectManyCheckbox id="x-values" value="#{inputBean.selectedXValues}" layout="responsive" columns="4">
                                <f:selectItem itemLabel="-4" itemValue="-4"/>
                                <f:selectItem itemLabel="-3" itemValue="-3"/>
                                <f:selectItem itemLabel="-2" itemValue="-2"/>
                                <f:selectItem itemLabel="-1" itemValue="-1"/>
                                <f:selectItem itemLabel="0" itemValue="0"/>
                                <f:selectItem itemLabel="1" itemValue="1"/>
                                <f:selectItem itemLabel="2" itemValue="2"/>
                            </p:selectManyCheckbox>

                            <p:outputLabel for="y-value" value="Введите Y:" />
                            <p:inputText
                                id="y-value"
                                value="#{inputBean.y}"
                                required="true"
                                maxlength="8"
                                placeholder="Число от -3 до 3 не включительно..."
                                requiredMessage="Y не может быть пустым">
                                <f:validator validatorId="yRangeValidator" />
                                <f:convertNumber />
                            </p:inputText>

                            <p:outputLabel for="r-values" value="Выберите R:" />
                            <p:selectManyCheckbox id="r-values" value="#{inputBean.selectedRValues}" layout="responsive" columns="5">
                                <f:selectItem itemLabel="1" itemValue="1"/>
                                <f:selectItem itemLabel="1.5" itemValue="1.5"/>
                                <f:selectItem itemLabel="2" itemValue="2"/>
                                <f:selectItem itemLabel="2.5" itemValue="2.5"/>
                                <f:selectItem itemLabel="3" itemValue="3"/>
                                <p:ajax listener="#{inputBean.onRChange}" oncomplete="handleRChange(args.selectedRJson)" />
                            </p:selectManyCheckbox>
                        </div>
                        <div class="row-container" style="margin: 1rem 0">
                            <p:commandButton
                                    value="Очистить"
                                    actionListener="#{inputBean.clear}"
                                    process="@this"
                                    update="control-form"
                                    styleClass="form-button"
                                    oncomplete="refreshCanvas();" />
                            <p:commandButton
                                    value="Проверить"
                                    action="#{inputBean.check}"
                                    process="@form"
                                    update="control-form response-table growl all-points-json max-r-value"
                                    styleClass="ui-button-success form-button"
                                    onclick="if (! validateForm()) return false;"
                                    oncomplete="refreshCanvas();" />
                        </div>
                    </h:form>

                    <p:growl id="growl" showDetail="true" />

                    <div class="section-title">
                        <h1>Results</h1>
                    </div>

                    <p:dataTable
                            id="response-table"
                            value="#{inputBean.reversedPoints}"
                            var="point"
                            styleClass="custom-table"
                            responsiveLayout="scroll"
                            scrollable="true"
                            scrollHeight="300px">
                        <p:column headerText="x">
                            <h:outputText value="#{point.x}" />
                        </p:column>
                        <p:column headerText="y">
                            <h:outputText value="#{point.y}" />
                        </p:column>
                        <p:column headerText="r">
                            <h:outputText value="#{point.r}" />
                        </p:column>
                        <p:column headerText="hit">
                            <h:outputText value='#{point.hit ?  "ПОПАЛ" : "ПРОМАЗАЛ"}' styleClass='#{point.hit ? "good" : "bad"}' />
                        </p:column>
                    </p:dataTable>

                </div>
            </div>
        </div>

        <h:inputHidden id="all-points-json" value="#{inputBean.allPointsAsJson}" />
        <h:inputHidden id="max-r-value" value="#{inputBean.maxR}" />

        <p:remoteCommand name="addFacesMessage"
                         actionListener="#{inputBean.addFacesMessage}"
                         update="growl"
                         process="@this"/>
        <p:remoteCommand name="addPointViaCanvas"
                         actionListener="#{inputBean.addPointViaCanvas}"
                         update="control-form response-table growl all-points-json max-r-value"
                         oncomplete="refreshCanvas()"
                         process="@this" />
    </main>

    <footer>
        <div class="container">
            <p>© 2025 Web Lab 3 - Михайлов Петр Сергеевич, P3211</p>
        </div>
    </footer>

    <h:outputScript library="script" name="map-canvas.js" />
    <h:outputScript library="script" name="form.js" />
</h:body>

</html>