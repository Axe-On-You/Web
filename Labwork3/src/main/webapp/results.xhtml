<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html lang="ru"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title>Web Lab 3 - Ð¤Ð¾Ñ€Ð¼Ð°</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <h:outputStylesheet library="style" name="style.css" />
</h:head>

<h:body>
    <header>
        <div class="container">
            <span class="head-link">P3211</span>
            <span class="head-link">ÐœÐ¸Ñ…Ð°Ð¹Ð»Ð¾Ð² ÐŸÐµÑ‚Ñ€ Ð¡ÐµÑ€Ð³ÐµÐµÐ²Ð¸Ñ‡</span>
            <span class="head-link">Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚:  28345</span>
        </div>
    </header>

    <main>
        <div class="navbar-container">
            <h:link value="Ð§Ð°ÑÑ‹" outcome="index" styleClass="btn" />
        </div>

        <div class="grid-container">
            <div class="map-container">
                <h1>Map</h1>
                <div id="canvas-wrapper" class="canvas-container">
                    <canvas id="map-canvas" width="300" height="300" />
                </div>
                <p id="current_coord" style="width: 100%; text-align: center">---</p>
            </div>
            <div class="form-container">
                <h1>Control unit</h1>
                <div class="control-unit-container" id="control-unit-div">
                    <h:form id="control-form" prependId="false">
                        <div class="form-grid">
                            <p:outputLabel for="r-values" value="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ R:" />
                            <p:selectManyCheckbox id="r-values" value="#{inputBean.selectedRValues}">
                                <f:selectItem itemLabel="1" itemValue="1"/>
                                <f:selectItem itemLabel="2" itemValue="2"/>
                                <f:selectItem itemLabel="3" itemValue="3"/>
                                <f:selectItem itemLabel="4" itemValue="4"/>
                                <f:selectItem itemLabel="5" itemValue="5"/>
                                <p:ajax listener="#{inputBean.onRChange}" oncomplete="handleRChange(args. selectedRJson)" />
                            </p:selectManyCheckbox>
                            <p:outputLabel for="x-value" value="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ X:" />
                            <p:selectOneMenu
                                    id="x-value"
                                    value="#{inputBean. x}"
                                    required="true"
                                    requiredMessage="Ð’Ñ‹Ð±ÐµÑ€Ð¸ Ñ…Ð¾Ñ‚Ñ Ð±Ñ‹ 1 Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ R">
                                <f:selectItem itemLabel="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ X" itemValue=""/>
                                <f:selectItem itemLabel="-4" itemValue="-4"/>
                                <f:selectItem itemLabel="-3" itemValue="-3"/>
                                <f:selectItem itemLabel="-2" itemValue="-2"/>
                                <f:selectItem itemLabel="-1" itemValue="-1"/>
                                <f:selectItem itemLabel="0" itemValue="0"/>
                                <f:selectItem itemLabel="1" itemValue="1"/>
                                <f:selectItem itemLabel="2" itemValue="2"/>
                                <f:selectItem itemLabel="3" itemValue="3"/>
                                <f:selectItem itemLabel="4" itemValue="4"/>
                            </p:selectOneMenu>
                            <p:outputLabel for="y-value" value="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Y:" />
                            <p:inputNumber
                                    id="y-value"
                                    value="#{inputBean.y}"
                                    required="true"
                                    placeholder="Ð§Ð¸ÑÐ»Ð¾ Ð¾Ñ‚ -5 Ð´Ð¾ 3 Ð½Ðµ Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾..."
                                    requiredMessage="Y Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼"
                                    decimalPlaces="5"
                                    decimalSeparator="."
                                    inputStyle="width: 100%">
                                <f:validator validatorId="yRangeValidator" />
                            </p:inputNumber>
                        </div>
                        <div class="row-container" style="margin:  1rem 0">
                            <p:commandButton
                                    value="ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ"
                                    actionListener="#{inputBean.clear}"
                                    process="@this"
                                    update="control-form"
                                    styleClass="form-button"
                                    oncomplete="refreshCanvas();" />
                            <p:commandButton
                                    value="ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ"
                                    actionListener="#{inputBean.check}"
                                    process="@form"
                                    update="control-form response-table growl all-points-json max-r-value"
                                    styleClass="ui-button-success form-button"
                                    onclick="if (! validateForm()) return false;"
                                    oncomplete="refreshCanvas();" />
                        </div>
                    </h:form>

                    <p:growl id="growl" showDetail="true" />

                    <div class="section-title">
                        <span class="title-icon">ðŸ“Š</span>
                        <h1>Results</h1>
                        <span class="title-icon">ðŸ“Š</span>
                    </div>

                    <p:dataTable
                            id="response-table"
                            value="#{inputBean.reversedPoints}"
                            var="point"
                            styleClass="custom-table"
                            responsiveLayout="scroll"
                            scrollable="true"
                            scrollHeight="300px">
                        <p:column headerText="x">
                            <h:outputText value="#{point. x}" />
                        </p:column>
                        <p:column headerText="y">
                            <h:outputText value="#{point.y}" />
                        </p:column>
                        <p:column headerText="r">
                            <h:outputText value="#{point.r}" />
                        </p:column>
                        <p:column headerText="hit">
                            <h:outputText value='#{point.hit ? "ÐŸÐžÐŸÐÐ›" : "ÐŸÐ ÐžÐœÐÐ—ÐÐ›"}' styleClass='#{point.hit ? "good" :  "bad"}' />
                        </p:column>
                    </p:dataTable>

                </div>
            </div>
        </div>

        <h:inputHidden id="all-points-json" value="#{inputBean.allPointsAsJson}" />
        <h:inputHidden id="max-r-value" value="#{inputBean.maxR}" />

        <p:remoteCommand name="addFacesMessage"
                         actionListener="#{inputBean.addFacesMessage}"
                         update="growl"
                         process="@this"/>
        <p:remoteCommand name="addPointViaCanvas"
                         actionListener="#{inputBean.addPointViaCanvas}"
                         update="control-form response-table growl all-points-json max-r-value"
                         oncomplete="refreshCanvas()"
                         process="@this" />
    </main>

    <footer>
        <div class="container">
            <p>Â© 2025 Web Lab 3 - ÐœÐ¸Ñ…Ð°Ð¹Ð»Ð¾Ð² ÐŸÐµÑ‚Ñ€ Ð¡ÐµÑ€Ð³ÐµÐµÐ²Ð¸Ñ‡, P3211</p>
        </div>
    </footer>

    <h:outputScript library="script" name="map-canvas.js" />
    <h:outputScript library="script" name="form.js" />
</h:body>

</html>